import{m as c}from"./maplibre-D6KsYbmY.js";import{P as w}from"./pmtiles-BC2bSfP7.js";const v="modulepreload",L=function(h,e){return new URL(h,e).href},f={},C=function(e,t,o){let r=Promise.resolve();if(t&&t.length>0){const s=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),g=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));r=Promise.allSettled(t.map(a=>{if(a=L(a,o),a in f)return;f[a]=!0;const d=a.endsWith(".css"),b=d?'[rel="stylesheet"]':"";if(!!o)for(let u=s.length-1;u>=0;u--){const p=s[u];if(p.href===a&&(!d||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${b}`))return;const l=document.createElement("link");if(l.rel=d?"stylesheet":v,d||(l.as="script"),l.crossOrigin="",l.href=a,g&&l.setAttribute("nonce",g),document.head.appendChild(l),d)return new Promise((u,p)=>{l.addEventListener("load",u),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}function i(s){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=s,window.dispatchEvent(n),!n.defaultPrevented)throw s}return r.then(s=>{for(const n of s||[])n.status==="rejected"&&i(n.reason);return e().catch(i)})};let m=null,y=null;async function O(){return m||(m=(await C(()=>import("./contour-iMovH0NX.js"),[],import.meta.url)).default,y=new m.DemSource({url:"https://elevation-tiles-prod.s3.amazonaws.com/terrarium/{z}/{x}/{y}.png",encoding:"terrarium",maxzoom:13,worker:!0,cacheSize:100,timeoutMs:1e4}),y.setupMaplibre(c)),{mlcontour:m,demSource:y}}class P{constructor(e,t={}){this.containerId=e,this.options={bounds:[[-75.5,44],[-74.5,45]],zoom:14,minZoom:11,maxZoom:16,showTileBoundaries:!1,...t},this.map=null,this.protocol=null,this.layerDrawOrder={background:0,hills:10,"land-use":20,land:25,"water-polygons":40,"water-polygon-outlines":41,"water-lines":42,contours:50,"contour-text":51,"roads-solid":60,"roads-dashed":61,buildings:80,"building-outlines":81,places:90,"place-labels":100},this.init()}init(){this.protocol=new w,c.addProtocol("pmtiles",this.protocol.tile),this.loadStyle().then(async e=>{this.createMap(e),this.setupEventHandlers(),this.addControls(),this.setupContourControls()}).catch(e=>{console.error("Failed to load map style:",e)})}async loadStyle(){try{const e=await fetch("./cartography.json");if(!e.ok)throw new Error(`Failed to load style: ${e.statusText}`);const t=await e.json();return this.updatePMTilesUrls(t),await this.addContourToStyle(t),this.sortLayersByDrawOrder(t),t}catch(e){return console.error("Error loading style:",e),this.getBasicStyle()}}updatePMTilesUrls(e){const t=window.location.origin+window.location.pathname.replace(/\/[^\/]*$/,"");for(const[o,r]of Object.entries(e.sources))if(r.type==="vector"&&r.url&&r.url.startsWith("pmtiles://tiles/")){const i=r.url.replace("pmtiles://tiles/","");r.url=`pmtiles://${t}/tiles/${i}`}}createMap(e){this.map=new c.Map({container:this.containerId,style:e,bounds:this.options.bounds,zoom:this.options.zoom,minZoom:this.options.minZoom,maxZoom:this.options.maxZoom}),this.map.showTileBoundaries=this.options.showTileBoundaries}setupEventHandlers(){this.map.on("load",()=>{const e=this.map.getStyle().layers;e.find(t=>t.id==="contours"),e.find(t=>t.id==="hills"),this.printLayerOrder(),this.setupContourControls()})}addControls(){this.map.addControl(new c.NavigationControl,"top-right"),this.map.addControl(new c.ScaleControl,"bottom-left")}setupContourControls(){if(!this.map){console.warn("Map not yet initialized for contour controls");return}const e=document.getElementById("contoursToggle");e&&e.addEventListener("change",r=>{this.toggleContours(r.target.checked)});const t=document.getElementById("hillshadeToggle");t&&t.addEventListener("change",r=>{this.toggleHillshade(r.target.checked)});const o=document.getElementById("blendModeSelect");o&&(o.addEventListener("change",r=>{this.setContourBlendMode(r.target.value)}),this.setContourBlendMode("darken"))}formatFeaturePopup(e){let t=`
            <div style="max-width: 200px;">
                <strong>Layer:</strong> ${e.sourceLayer||e.source}<br>
        `;if(e.sourceLayer==="contours"){const o=e.properties.ele,r=e.properties.level;t+=`
                <strong>Elevation:</strong> ${o}' (${Math.round(o*.3048)}m)<br>
                <strong>Contour Type:</strong> ${r>0?"Major":"Minor"}<br>
            `}return t+=`
                <strong>Properties:</strong><br>
                <pre style="font-size: 10px; white-space: pre-wrap;">${JSON.stringify(e.properties,null,2)}</pre>
            </div>
        `,t}getBasicStyle(){return{version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"#f0f0f0"}}]}}async addContourToStyle(e){const{demSource:t}=await O();e.sources.dem={type:"raster-dem",encoding:"terrarium",tiles:[t.sharedDemProtocolUrl],maxzoom:13,tileSize:256},e.sources.contours={type:"vector",tiles:[t.contourProtocolUrl({multiplier:3.28084,thresholds:{11:[200,1e3],12:[100,500],13:[100,500],14:[50,200],15:[20,100],16:[20,100]},elevationKey:"ele",levelKey:"level",contourLayer:"contours"})],maxzoom:16};const o={id:"hills",type:"hillshade",source:"dem",paint:{"hillshade-exaggeration":.25,"hillshade-shadow-color":"rgba(0,0,0,0.3)","hillshade-highlight-color":"rgba(255,255,255,0.3)"}},r={id:"contours",type:"line",source:"contours","source-layer":"contours",paint:{"line-color":["interpolate",["linear"],["zoom"],11,"rgba(0, 0, 0, 0.4)",13,"rgba(50, 25, 0, 0.5)",15,"rgba(80, 40, 20, 0.6)"],"line-width":["interpolate",["linear"],["zoom"],11,["case",["==",["get","level"],1],.9,.45],13,["case",["==",["get","level"],1],1.1,.5],15,["case",["==",["get","level"],1],1.4,.7]],"line-opacity":["interpolate",["linear"],["zoom"],11,.6,13,.7,15,.8]},layout:{"line-join":"round","line-cap":"round"}},i={id:"contour-text",type:"symbol",source:"contours","source-layer":"contours",filter:[">",["get","level"],0],paint:{"text-halo-color":"white","text-halo-width":2,"text-color":"rgba(139, 69, 19, 0.8)"},layout:{visibility:"none","symbol-placement":"line","text-anchor":"center","text-size":10,"text-field":["concat",["number-format",["get","ele"],{}],"'"],"text-font":["Noto Sans Bold"],"text-rotation-alignment":"map"}};e.layers.push(o),e.layers.push(r),e.layers.push(i)}sortLayersByDrawOrder(e){return e.layers&&(e.layers.sort((t,o)=>{const r=this.layerDrawOrder[t.id]!==void 0?this.layerDrawOrder[t.id]:999,i=this.layerDrawOrder[o.id]!==void 0?this.layerDrawOrder[o.id]:999;return r-i}),console.log("Layer draw order applied:",e.layers.map(t=>({id:t.id,order:this.layerDrawOrder[t.id]||"unspecified"})))),e}addLayerWithOrder(e,t,o){if(!this.map)return;this.layerDrawOrder[e]=t;const r=Object.entries(this.layerDrawOrder).filter(([s,n])=>this.map.getLayer(s)&&n<=t).sort((s,n)=>n[1]-s[1]),i=r.length>0?r[0][0]:void 0;this.map.addLayer(o,i),console.log(`Added layer '${e}' with draw order ${t}`)}updateLayerOrder(e,t){if(!this.map||!this.map.getLayer(e))return;this.layerDrawOrder[e]=t;const o=this.map.getLayer(e);this.map.removeLayer(e),this.addLayerWithOrder(e,t,o)}getMap(){return this.map}toggleLayer(e,t=null){if(!this.map)return;const o=t!==null?t?"visible":"none":this.map.getLayoutProperty(e,"visibility")==="none"?"visible":"none";this.map.setLayoutProperty(e,"visibility",o)}toggleContours(e=null){this.toggleLayer("contours",e),this.toggleLayer("contour-text",e)}toggleHillshade(e=null){this.toggleLayer("hills",e)}setContourInterval(e,t){this.map&&(Math.floor(this.map.getZoom()),console.log(`Contour intervals set to: minor=${e}ft, major=${t}ft`))}setContourBlendMode(e="normal"){if(!this.map||!this.map.getLayer("contours"))return;let t,o;switch(e){case"darken":t=["interpolate",["linear"],["zoom"],11,"rgba(0, 0, 0, 0.4)",13,"rgba(50, 25, 0, 0.5)",15,"rgba(80, 40, 20, 0.6)"],o=["interpolate",["linear"],["zoom"],11,.6,13,.7,15,.8];break;case"multiply":t=["interpolate",["linear"],["zoom"],11,"rgba(40, 20, 10, 0.3)",13,"rgba(60, 30, 15, 0.4)",15,"rgba(80, 40, 20, 0.5)"],o=.9;break;case"overlay":t=["interpolate",["linear"],["zoom"],11,"rgba(139, 69, 19, 0.3)",13,"rgba(160, 80, 40, 0.4)",15,"rgba(180, 90, 45, 0.5)"],o=.7;break;case"normal":default:t="rgba(139, 69, 19, 0.6)",o=1;break}this.map.setPaintProperty("contours","line-color",t),this.map.setPaintProperty("contours","line-opacity",o),console.log(`Contour blend mode set to: ${e}`)}destroy(){this.map||this.map.remove(),this.protocol&&c.removeProtocol("pmtiles")}getLayerDrawOrder(){return{...this.layerDrawOrder}}getLayersByDrawOrder(){return this.map?this.map.getStyle().layers.map(t=>({id:t.id,order:this.layerDrawOrder[t.id]||999})).sort((t,o)=>t.order-o.order).map(t=>t.id):[]}printLayerOrder(){if(!this.map){console.log("Map not initialized");return}const e=this.map.getStyle().layers;console.log("Current layer stack (bottom to top):"),console.table(e.map((t,o)=>({Position:o,"Layer ID":t.id,"Draw Order":this.layerDrawOrder[t.id]||"unspecified",Type:t.type})))}}window.addEventListener("beforeunload",()=>{c.removeProtocol("pmtiles")});const z=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"}));export{C as _,z as b};
//# sourceMappingURL=app-D8KB9ipM.js.map
