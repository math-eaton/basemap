var ye,Ie,Te;function Ee(u,I){if(!ye)ye=I;else if(!Ie)Ie=I;else{var G="var sharedChunk = {}; ("+ye+")(sharedChunk); ("+Ie+")(sharedChunk);",R={};ye(R),Te=I(R),typeof window<"u"&&(Te.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}Ee(["exports"],function(u){class I{constructor(e,t){this.start=e,this.end=t,this.points=[],this.append=this.append.bind(this),this.prepend=this.prepend.bind(this)}append(e,t){this.points.push(Math.round(e),Math.round(t))}prepend(e,t){this.points.splice(0,0,Math.round(e),Math.round(t))}lineString(){return this.toArray()}isEmpty(){return this.points.length<2}appendFragment(e){this.points.push(...e.points),this.end=e.end}toArray(){return this.points}}const G=[[],[[[1,2],[0,1]]],[[[2,1],[1,2]]],[[[2,1],[0,1]]],[[[1,0],[2,1]]],[[[1,2],[0,1]],[[1,0],[2,1]]],[[[1,0],[1,2]]],[[[1,0],[0,1]]],[[[0,1],[1,0]]],[[[1,2],[1,0]]],[[[0,1],[1,0]],[[2,1],[1,2]]],[[[2,1],[1,0]]],[[[0,1],[2,1]]],[[[1,2],[2,1]]],[[[0,1],[1,2]]],[]];function R(i,e,t,s){return e=e*2+s[0],t=t*2+s[1],e+t*(i+1)*2}function W(i,e,t){return(e-i)/(t-i)}function k(i,e,t=4096,s=1){if(!i)return{};const n=t/(e.width-1);let o,r,a,h,l,c;const d={},f=new Map,P=new Map;function D(b,C,V){b[0]===0?V(n*(c-1),n*(l-W(a,C,o))):b[0]===2?V(n*c,n*(l-W(h,C,r))):b[1]===0?V(n*(c-W(r,C,o)),n*(l-1)):V(n*(c-W(h,C,a)),n*l)}for(l=1-s;l<e.height+s;l++){r=e.get(0,l-1),h=e.get(0,l);let b=Math.min(r,h),C=Math.max(r,h);for(c=1-s;c<e.width+s;c++){o=r,a=h,r=e.get(c,l-1),h=e.get(c,l);const V=b,L=C;if(b=Math.min(r,h),C=Math.max(r,h),isNaN(o)||isNaN(r)||isNaN(h)||isNaN(a))continue;const he=Math.min(V,b),ce=Math.max(L,C),M=Math.ceil(he/i)*i,ee=Math.floor(ce/i)*i;for(let y=M;y<=ee;y+=i){const be=o>y,q=r>y,ie=a>y,me=h>y;for(const pe of G[(be?8:0)|(q?4:0)|(me?2:0)|(ie?1:0)]){let $=f.get(y);$||f.set(y,$=new Map);let se=P.get(y);se||P.set(y,se=new Map);const Me=pe[0],xe=pe[1],de=R(e.width,c,l,Me),ne=R(e.width,c,l,xe);let S,Fe;if(S=se.get(de))if(se.delete(de),Fe=$.get(ne))if($.delete(ne),S===Fe){if(D(xe,y,S.append),!S.isEmpty()){let te=d[y];te||(d[y]=te=[]),te.push(S.lineString())}}else S.appendFragment(Fe),se.set(S.end=Fe.end,S);else D(xe,y,S.append),se.set(S.end=ne,S);else if(S=$.get(ne))$.delete(ne),D(Me,y,S.prepend),$.set(S.start=de,S);else{const te=new I(de,ne);D(Me,y,te.append),D(xe,y,te.append),$.set(de,te),se.set(ne,te)}}}}}for(const[b,C]of f.entries()){let V=null;for(const L of C.values())L.isEmpty()||(V==null&&(V=d[b]||(d[b]=[])),V.push(L.lineString()))}return d}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function B(i,e){var t={};for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(i);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(i,s[n])&&(t[s[n]]=i[s[n]]);return t}function v(i,e,t,s){function n(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function a(c){try{l(s.next(c))}catch(d){r(d)}}function h(c){try{l(s.throw(c))}catch(d){r(d)}}function l(c){c.done?o(c.value):n(c.value).then(a,h)}l((s=s.apply(i,e||[])).next())})}function O(i){const e=Object.entries(i);return e.sort(([t],[s])=>t<s?-1:t>s?1:0),e}function Y(i){return O(i).map(([e,t])=>[e,...typeof t=="number"?[t]:t].join("*")).join("~")}function H(i){return Object.fromEntries(i.split("~").map(e=>e.split("*").map(Number)).map(([e,...t])=>[e,t]))}function p(i){var{thresholds:e}=i,t=B(i,["thresholds"]);return O(Object.assign({thresholds:Y(e)},t)).map(([s,n])=>`${encodeURIComponent(s)}=${encodeURIComponent(n)}`).join("&")}function w(i){return Object.fromEntries(i.replace(/^.*\?/,"").split("&").map(e=>{const t=e.split("=").map(decodeURIComponent),s=t[0];let n=t[1];switch(s){case"thresholds":n=H(n);break;case"extent":case"multiplier":case"overzoom":case"buffer":n=Number(n)}return[s,n]}))}function F(i){return O(i).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join(",")}function g(i,e){const{thresholds:t}=i,s=B(i,["thresholds"]);let n=[],o=-1/0;return Object.entries(t).forEach(([r,a])=>{const h=Number(r);h<=e&&h>o&&(o=h,n=typeof a=="number"?[a]:a)}),Object.assign({levels:n},s)}function m(i){const e=new ArrayBuffer(i.byteLength);return new Uint8Array(e).set(new Uint8Array(i)),e}function T(i,e){return i.then(t=>{var{data:s}=t,n=B(t,["data"]);let o=s;return e&&(o=new Float32Array(s.length),o.set(s)),Object.assign(Object.assign({},n),{data:o,transferrables:[o.buffer]})})}function K(i){return i.then(({arrayBuffer:e})=>{const t=m(e);return{arrayBuffer:t,transferrables:[t]}})}let U=null;function re(){return U==null&&(U=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),U||!1}let z=null;function ve(){if(z==null&&(z=!1,re()&&typeof VideoFrame<"u")){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<5*5;n++){const o=n*4;t.fillStyle=`rgb(${o},${o+1},${o+2})`,t.fillRect(n%5,Math.floor(n/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!==3&&s[n]!==n){z=!0;break}}}return z||!1}function fe(i,e,t){let s=()=>{};const n=setTimeout(()=>{s(new Error("timed out")),t==null||t.abort()},i);x(t,()=>{s(new Error("aborted")),clearTimeout(n)});const o=new Promise((r,a)=>{s=a});return Promise.race([o,e.finally(()=>clearTimeout(n))])}function x(i,e){e&&(i==null||i.signal.addEventListener("abort",e))}function _(i){var e;return!!(!((e=i==null?void 0:i.signal)===null||e===void 0)&&e.aborted)}let Z=0;class X{constructor(e=100){this.size=()=>this.items.size,this.get=(t,s,n)=>{let o=this.items.get(t);if(o)o.lastUsed=++Z,o.waiting++;else{const l=new AbortController,c=s(t,l);o={abortController:l,item:c,lastUsed:++Z,waiting:1},this.items.set(t,o),this.prune()}const r=this.items,a=o.item.then(l=>l,l=>(r.delete(t),Promise.reject(l)));let h=!1;return x(n,()=>{var l;o&&o.abortController&&!h&&(h=!0,--o.waiting<=0&&((l=o.abortController)===null||l===void 0||l.abort(),r.delete(t)))}),a},this.clear=()=>this.items.clear(),this.maxSize=e,this.items=new Map}prune(){if(this.items.size>this.maxSize){let e,t=1/0;this.items.forEach((s,n)=>{s.lastUsed<t&&(t=s.lastUsed,e=n)}),typeof e<"u"&&this.items.delete(e)}}}let E,Q,j,N;function ue(i,e,t){return v(this,void 0,void 0,function*(){const s=yield createImageBitmap(i);return _(t)?null:Ce(s,e)})}function Ce(i,e){return E||(E=new OffscreenCanvas(i.width,i.height),Q=E.getContext("2d",{willReadFrequently:!0})),Oe(i,e,E,Q)}function ze(i,e,t){return v(this,void 0,void 0,function*(){var s,n,o;const r=yield createImageBitmap(i);if(_(t))return null;const a=new VideoFrame(r,{timestamp:0});try{if(!(((s=a==null?void 0:a.format)===null||s===void 0?void 0:s.startsWith("BGR"))||((n=a==null?void 0:a.format)===null||n===void 0?void 0:n.startsWith("RGB"))))throw new Error(`Unrecognized format: ${a==null?void 0:a.format}`);const l=(o=a==null?void 0:a.format)===null||o===void 0?void 0:o.startsWith("BGR"),c=a.allocationSize(),d=new Uint8ClampedArray(c);if(yield a.copyTo(d),l)for(let f=0;f<d.length;f+=4){const P=d[f];d[f]=d[f+2],d[f+2]=P}return Pe(r.width,r.height,e,d)}catch{return _(t)?null:Ce(r,e)}finally{a.close()}})}function _e(i,e,t){return v(this,void 0,void 0,function*(){j||(j=document.createElement("canvas"),N=j.getContext("2d",{willReadFrequently:!0}));const s=new Image;x(t,()=>s.src="");const n=yield new Promise((o,r)=>{s.onload=()=>{_(t)||o(s),URL.revokeObjectURL(s.src),s.onload=null},s.onerror=()=>r(new Error("Could not load image.")),s.src=i.size?URL.createObjectURL(i):""});return Oe(n,e,j,N)})}function je(i,e,t){return self.actor.send("decodeImage",[],t,void 0,i,e)}function $e(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}const Be=ve()?ze:re()?ue:$e()?je:_e;function Oe(i,e,t,s){if(t.width=i.width,t.height=i.height,!s)throw new Error("failed to get context");s.drawImage(i,0,0,i.width,i.height);const n=s.getImageData(0,0,i.width,i.height).data;return Pe(i.width,i.height,e,n)}function Pe(i,e,t,s){const n=t==="mapbox"?(r,a,h)=>-1e4+(r*256*256+a*256+h)*.1:(r,a,h)=>r*256+a+h/256-32768,o=new Float32Array(i*e);for(let r=0;r<s.length;r+=4)o[r/4]=n(s[r],s[r+1],s[r+2]);return{width:i,height:e,data:o}}const Ge=-12e3,We=9e3;function Ye(i){return!isNaN(i)&&i>=Ge&&i<=We}class A{constructor(e,t,s){this.split=(n,o,r)=>{if(n===0)return this;const a=1<<n,h=o*this.width/a,l=r*this.height/a;return new A(this.width/a,this.height/a,(c,d)=>this.get(c+h,d+l))},this.subsamplePixelCenters=n=>{const o=(h,l,c)=>isNaN(h)?l:isNaN(l)?h:h+(l-h)*c;if(n<=1)return this;const r=.5-1/(2*n),a=(h,l)=>{const c=h/n-r,d=l/n-r,f=Math.floor(c),P=Math.floor(d),D=this.get(f,P),b=this.get(f+1,P),C=this.get(f,P+1),V=this.get(f+1,P+1),L=c-f,he=d-P,ce=o(D,b,L),M=o(C,V,L);return o(ce,M,he)};return new A(this.width*n,this.height*n,a)},this.averagePixelCentersToGrid=(n=1)=>new A(this.width+1,this.height+1,(o,r)=>{let a=0,h=0,l=0;for(let c=o-n;c<o+n;c++)for(let d=r-n;d<r+n;d++)isNaN(l=this.get(c,d))||(h++,a+=l);return h===0?NaN:a/h}),this.scaleElevation=n=>n===1?this:new A(this.width,this.height,(o,r)=>this.get(o,r)*n),this.materialize=(n=2)=>{const o=this.width+2*n,r=new Float32Array(o*(this.height+2*n));let a=0;for(let h=-n;h<this.height+n;h++)for(let l=-n;l<this.width+n;l++)r[a++]=this.get(l,h);return new A(this.width,this.height,(h,l)=>r[(l+n)*o+h+n])},this.get=s,this.width=e,this.height=t}static fromRawDem(e){return new A(e.width,e.height,(t,s)=>{const n=e.data[s*e.width+t];return Ye(n)?n:NaN})}static combineNeighbors(e){if(e.length!==9)throw new Error("Must include a tile plus 8 neighbors");const t=e[4];if(!t)return;const s=t.width,n=t.height;return new A(s,n,(o,r)=>{let a=0;r<0?r+=n:r<n?a+=3:(r-=n,a+=6),o<0?o+=s:o<s?a+=1:(o-=s,a+=2);const h=e[a];return h?h.get(o,r):NaN})}}const ke=65536*65536,Ne=1/ke,Ke=12,De=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),Ve=0,we=1,le=2,ge=5;class Xe{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,s=this.length){for(;this.pos<s;){const n=this.readVarint(),o=n>>3,r=this.pos;this.type=n&7,e(o,t,this),this.pos===r&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ke;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ke;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let s,n;return n=t[this.pos++],s=n&127,n<128||(n=t[this.pos++],s|=(n&127)<<7,n<128)||(n=t[this.pos++],s|=(n&127)<<14,n<128)||(n=t[this.pos++],s|=(n&127)<<21,n<128)?s:(n=t[this.pos],s|=(n&15)<<28,Je(s,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Ke&&De?De.decode(this.buf.subarray(t,e)):ht(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===le?this.readVarint()+this.pos:this.pos+1}skip(e){const t=e&7;if(t===Ve)for(;this.buf[this.pos++]>127;);else if(t===le)this.pos=this.readVarint()+this.pos;else if(t===ge)this.pos+=4;else if(t===we)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ne),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ne),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){qe(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;const t=this.pos;this.pos=lt(this.buf,e,this.pos);const s=this.pos-t;s>=128&&Ue(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let s=0;s<t;s++)this.buf[this.pos++]=e[s]}writeRawMessage(e,t){this.pos++;const s=this.pos;e(t,this);const n=this.pos-s;n>=128&&Ue(s,n,this),this.pos=s-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,s){this.writeTag(e,le),this.writeRawMessage(t,s)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Qe,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,et,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,st,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,tt,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,it,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,nt,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,rt,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,ot,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,at,t)}writeBytesField(e,t){this.writeTag(e,le),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,ge),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,ge),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,we),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,we),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,Ve),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,Ve),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,le),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,ge),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,we),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function Je(i,e,t){const s=t.buf;let n,o;if(o=s[t.pos++],n=(o&112)>>4,o<128||(o=s[t.pos++],n|=(o&127)<<3,o<128)||(o=s[t.pos++],n|=(o&127)<<10,o<128)||(o=s[t.pos++],n|=(o&127)<<17,o<128)||(o=s[t.pos++],n|=(o&127)<<24,o<128)||(o=s[t.pos++],n|=(o&1)<<31,o<128))return oe(i,n,e);throw new Error("Expected varint not more than 10 bytes")}function oe(i,e,t){return t?e*4294967296+(i>>>0):(e>>>0)*4294967296+(i>>>0)}function qe(i,e){let t,s;if(i>=0?(t=i%4294967296|0,s=i/4294967296|0):(t=~(-i%4294967296),s=~(-i/4294967296),t^4294967295?t=t+1|0:(t=0,s=s+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),He(t,s,e),Ze(s,e)}function He(i,e,t){t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos++]=i&127|128,i>>>=7,t.buf[t.pos]=i&127}function Ze(i,e){const t=(i&7)<<4;e.buf[e.pos++]|=t|((i>>>=3)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127|((i>>>=7)?128:0),i&&(e.buf[e.pos++]=i&127)))))}function Ue(i,e,t){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(s);for(let n=t.pos-1;n>=i;n--)t.buf[n+s]=t.buf[n]}function Qe(i,e){for(let t=0;t<i.length;t++)e.writeVarint(i[t])}function et(i,e){for(let t=0;t<i.length;t++)e.writeSVarint(i[t])}function tt(i,e){for(let t=0;t<i.length;t++)e.writeFloat(i[t])}function it(i,e){for(let t=0;t<i.length;t++)e.writeDouble(i[t])}function st(i,e){for(let t=0;t<i.length;t++)e.writeBoolean(i[t])}function nt(i,e){for(let t=0;t<i.length;t++)e.writeFixed32(i[t])}function rt(i,e){for(let t=0;t<i.length;t++)e.writeSFixed32(i[t])}function ot(i,e){for(let t=0;t<i.length;t++)e.writeFixed64(i[t])}function at(i,e){for(let t=0;t<i.length;t++)e.writeSFixed64(i[t])}function ht(i,e,t){let s="",n=e;for(;n<t;){const o=i[n];let r=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a>t)break;let h,l,c;a===1?o<128&&(r=o):a===2?(h=i[n+1],(h&192)===128&&(r=(o&31)<<6|h&63,r<=127&&(r=null))):a===3?(h=i[n+1],l=i[n+2],(h&192)===128&&(l&192)===128&&(r=(o&15)<<12|(h&63)<<6|l&63,(r<=2047||r>=55296&&r<=57343)&&(r=null))):a===4&&(h=i[n+1],l=i[n+2],c=i[n+3],(h&192)===128&&(l&192)===128&&(c&192)===128&&(r=(o&15)<<18|(h&63)<<12|(l&63)<<6|c&63,(r<=65535||r>=1114112)&&(r=null))),r===null?(r=65533,a=1):r>65535&&(r-=65536,s+=String.fromCharCode(r>>>10&1023|55296),r=56320|r&1023),s+=String.fromCharCode(r),n+=a}return s}function lt(i,e,t){for(let s=0,n,o;s<e.length;s++){if(n=e.charCodeAt(s),n>55295&&n<57344)if(o)if(n<56320){i[t++]=239,i[t++]=191,i[t++]=189,o=n;continue}else n=o-55296<<10|n-56320|65536,o=null;else{n>56319||s+1===e.length?(i[t++]=239,i[t++]=191,i[t++]=189):o=n;continue}else o&&(i[t++]=239,i[t++]=191,i[t++]=189,o=null);n<128?i[t++]=n:(n<2048?i[t++]=n>>6|192:(n<65536?i[t++]=n>>12|224:(i[t++]=n>>18|240,i[t++]=n>>12&63|128),i[t++]=n>>6&63|128),i[t++]=n&63|128)}return t}var ae;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.POINT=1]="POINT",i[i.LINESTRING=2]="LINESTRING",i[i.POLYGON=3]="POLYGON"})(ae||(ae={}));function ct(i){const e=new Xe;for(const t in i.layers){const s=i.layers[t];s.extent||(s.extent=i.extent),e.writeMessage(3,dt,Object.assign(Object.assign({},s),{id:t}))}return e.finish()}function dt(i,e){if(!e)throw new Error("pbf undefined");e.writeVarintField(15,2),e.writeStringField(1,i.id||""),e.writeVarintField(5,i.extent||4096);const t={keys:[],values:[],keycache:{},valuecache:{}};for(const s of i.features)t.feature=s,e.writeMessage(2,ft,t);for(const s of t.keys)e.writeStringField(3,s);for(const s of t.values)e.writeMessage(4,gt,s)}function ft(i,e){const t=i.feature;if(!t||!e)throw new Error;e.writeMessage(2,ut,i),e.writeVarintField(3,t.type),e.writeMessage(4,wt,t)}function ut(i,e){const t=i.feature;if(!t||!e)throw new Error;const s=i.keys,n=i.values,o=i.keycache,r=i.valuecache;for(const a in t.properties){let h=t.properties[a],l=o[a];if(h===null)continue;typeof l>"u"&&(s.push(a),l=s.length-1,o[a]=l),e.writeVarint(l);const c=typeof h;c!=="string"&&c!=="boolean"&&c!=="number"&&(h=JSON.stringify(h));const d=`${c}:${h}`;let f=r[d];typeof f>"u"&&(n.push(h),f=n.length-1,r[d]=f),e.writeVarint(f)}}function Se(i,e){return(e<<3)+(i&7)}function Ae(i){return i<<1^i>>31}function wt(i,e){if(!e)throw new Error;const t=i.geometry,s=i.type;let n=0,o=0;for(const r of t){let a=1;s===ae.POINT&&(a=r.length/2),e.writeVarint(Se(1,a));const h=r.length/2,l=s===ae.POLYGON?h-1:h;for(let c=0;c<l;c++){c===1&&s!==1&&e.writeVarint(Se(2,l-1));const d=r[c*2]-n,f=r[c*2+1]-o;e.writeVarint(Ae(d)),e.writeVarint(Ae(f)),n+=d,o+=f}s===ae.POLYGON&&e.writeVarint(Se(7,1))}}function gt(i,e){if(!e)throw new Error;typeof i=="string"?e.writeStringField(1,i):typeof i=="boolean"?e.writeBooleanField(7,i):typeof i=="number"&&(i%1!==0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}const J=typeof performance<"u"?performance:void 0,mt=J?J.timeOrigin||new Date().getTime()-J.now():new Date().getTime();function pt(i){var e;return JSON.parse(JSON.stringify(((e=J==null?void 0:J.getEntriesByName)===null||e===void 0?void 0:e.call(J,i))||[]))}function Le(){return J?J.now():new Date().getTime()}function xt(i){const e=[];for(const t of i)e.push(...t);return e}class Re{constructor(e){this.marks={},this.urls=[],this.fetched=[],this.resources=[],this.tilesFetched=0,this.timeOrigin=mt,this.finish=t=>{this.markFinish();const s=h=>{const l=this.marks[h]||[],c=Math.max(...l.map(f=>Math.max(...f))),d=Math.min(...l.map(f=>Math.min(...f)));return Number.isFinite(c)?c-d:void 0},n=s("main")||0,o=s("fetch"),r=s("decode"),a=s("isoline");return{url:t,tilesUsed:this.tilesFetched,origin:this.timeOrigin,marks:this.marks,resources:[...this.resources,...xt(this.fetched.map(pt))],duration:n,fetch:o,decode:r,process:a,wait:n-(o||0)-(r||0)-(a||0)}},this.error=t=>Object.assign(Object.assign({},this.finish(t)),{error:!0}),this.marker=t=>{var s;this.marks[t]||(this.marks[t]=[]);const n=[Le()];return(s=this.marks[t])===null||s===void 0||s.push(n),()=>n.push(Le())},this.useTile=t=>{this.urls.indexOf(t)<0&&(this.urls.push(t),this.tilesFetched++)},this.fetchTile=t=>{this.fetched.indexOf(t)<0&&this.fetched.push(t)},this.addAll=t=>{var s;this.tilesFetched+=t.tilesUsed;const n=t.origin-this.timeOrigin;for(const o in t.marks){const r=o;(this.marks[r]||(this.marks[r]=[])).push(...((s=t.marks[r])===null||s===void 0?void 0:s.map(h=>h.map(l=>l+n)))||[])}this.resources.push(...t.resources.map(o=>yt(o,n)))},this.markFinish=this.marker(e)}}const Ft=/(Start$|End$|^start|^end)/;function yt(i,e){const t={};for(const s in i)i[s]!==0&&Ft.test(s)?t[s]=Number(i[s])+e:t[s]=i[s];return t}const vt=(i,e)=>v(void 0,void 0,void 0,function*(){const t={signal:e.signal},s=yield fetch(i,t);if(!s.ok)throw new Error(`Bad response: ${s.status} for ${i}`);return{data:yield s.blob(),expires:s.headers.get("expires")||void 0,cacheControl:s.headers.get("cache-control")||void 0}});class Pt{constructor(e){this.loaded=Promise.resolve(),this.fetchAndParseTile=(t,s,n,o,r)=>{const a=this,h=this.demUrlPattern.replace("{z}",t.toString()).replace("{x}",s.toString()).replace("{y}",n.toString());return r==null||r.useTile(h),this.parsedCache.get(h,(l,c)=>v(this,void 0,void 0,function*(){const d=yield a.fetchTile(t,s,n,c,r);if(_(c))throw new Error("canceled");const f=a.decodeImage(d.data,a.encoding,c),P=r==null?void 0:r.marker("decode"),D=yield f;return P==null||P(),D}),o)},this.tileCache=new X(e.cacheSize),this.parsedCache=new X(e.cacheSize),this.contourCache=new X(e.cacheSize),this.timeoutMs=e.timeoutMs,this.demUrlPattern=e.demUrlPattern,this.encoding=e.encoding,this.maxzoom=e.maxzoom,this.decodeImage=e.decodeImage||Be,this.getTile=e.getTile||vt}fetchTile(e,t,s,n,o){const r=this.demUrlPattern.replace("{z}",e.toString()).replace("{x}",t.toString()).replace("{y}",s.toString());return o==null||o.useTile(r),this.tileCache.get(r,(a,h)=>{o==null||o.fetchTile(r);const l=o==null?void 0:o.marker("fetch");return fe(this.timeoutMs,this.getTile(r,h).finally(()=>l==null?void 0:l()),h)},n)}fetchDem(e,t,s,n,o,r){return v(this,void 0,void 0,function*(){const a=Math.min(e-(n.overzoom||0),this.maxzoom),h=e-a,l=1<<h,c=Math.floor(t/l),d=Math.floor(s/l),f=yield this.fetchAndParseTile(a,c,d,o,r);return A.fromRawDem(f).split(h,t%l,s%l)})}fetchContourTile(e,t,s,n,o,r){const{levels:a,multiplier:h=1,buffer:l=1,extent:c=4096,contourLayer:d="contours",elevationKey:f="ele",levelKey:P="level",subsampleBelow:D=100}=n;if(!a||a.length===0)return Promise.resolve({arrayBuffer:new ArrayBuffer(0)});const b=[e,t,s,F(n)].join("/");return this.contourCache.get(b,(C,V)=>v(this,void 0,void 0,function*(){const L=1<<e,he=[];for(let q=s-1;q<=s+1;q++)for(let ie=t-1;ie<=t+1;ie++)he.push(q<0||q>=L?void 0:this.fetchDem(e,(ie+L)%L,q,n,V,r));const ce=yield Promise.all(he);let M=A.combineNeighbors(ce);if(!M||_(V))return{arrayBuffer:new Uint8Array().buffer};const ee=r==null?void 0:r.marker("isoline");if(M.width>=D)M=M.materialize(2);else for(;M.width<D;)M=M.subsamplePixelCenters(2).materialize(2);M=M.averagePixelCentersToGrid().scaleElevation(h).materialize(1);const y=k(a[0],M,c,l);ee==null||ee();const be=ct({extent:c,layers:{[d]:{features:Object.entries(y).map(([q,ie])=>{const me=Number(q);return{type:ae.LINESTRING,geometry:ie,properties:{[f]:me,[P]:Math.max(...a.map((pe,$)=>me%pe===0?$:0))}}})}}});return ee==null||ee(),{arrayBuffer:be.buffer}}),o)}}let kt=0;class Vt{constructor(e,t,s=2e4){this.callbacks={},this.cancels={},this.dest=e,this.timeoutMs=s,this.dest.onmessage=n=>v(this,[n],void 0,function*({data:o}){const r=o;if(r.type==="cancel"){const a=this.cancels[r.id];delete this.cancels[r.id],a==null||a.abort()}else if(r.type==="response"){const a=this.callbacks[r.id];delete this.callbacks[r.id],a&&a(r.error?new Error(r.error):void 0,r.response,r.timings)}else if(r.type==="request"){const a=new Re("worker"),h=t[r.name],l=new AbortController,c=h.apply(h,[...r.args,l,a]),d=`${r.name}_${r.id}`;if(r.id&&c){this.cancels[r.id]=l;try{const f=yield c,P=f==null?void 0:f.transferrables;this.postMessage({id:r.id,type:"response",response:f,timings:a.finish(d)},P)}catch(f){this.postMessage({id:r.id,type:"response",error:(f==null?void 0:f.toString())||"error",timings:a.finish(d)})}delete this.cancels[r.id]}}})}postMessage(e,t){this.dest.postMessage(e,t||[])}send(e,t,s,n,...o){const r=++kt,a=new Promise((h,l)=>{this.postMessage({id:r,type:"request",name:e,args:o},t),this.callbacks[r]=(c,d,f)=>{n==null||n.addAll(f),c?l(c):h(d)}});return x(s,()=>{delete this.callbacks[r],this.postMessage({id:r,type:"cancel"})}),fe(this.timeoutMs,a,s)}}u.A=Vt,u.H=A,u.L=Pt,u.T=Re,u._=v,u.a=w,u.b=k,u.c=Pe,u.d=Be,u.e=p,u.f=K,u.g=g,u.p=T});Ee(["./shared"],function(u){const I=W=>Promise.reject(new Error(`No manager registered for ${W}`));class G{constructor(){this.managers={},this.init=(k,B)=>(this.managers[k.managerId]=new u.L(k),Promise.resolve()),this.fetchTile=(k,B,v,O,Y,H)=>{var p;return((p=this.managers[k])===null||p===void 0?void 0:p.fetchTile(B,v,O,Y,H))||I(k)},this.fetchAndParseTile=(k,B,v,O,Y,H)=>{var p;return u.p(((p=this.managers[k])===null||p===void 0?void 0:p.fetchAndParseTile(B,v,O,Y,H))||I(k),!0)},this.fetchContourTile=(k,B,v,O,Y,H,p)=>{var w;return u.f(((w=this.managers[k])===null||w===void 0?void 0:w.fetchContourTile(B,v,O,Y,H,p))||I(k))}}}const R=typeof self<"u"?self:typeof window<"u"?window:global;R.actor=new u.A(R,new G)});Ee(["./shared"],function(u){const I={workerUrl:""};let G,R=0;class W{constructor(){this.decodeImage=(w,F,g)=>u.p(u.d(w,F,g),!1)}}function k(){if(!G){const p=new Worker(I.workerUrl),w=new W;G=new u.A(p,w)}return G}class B{constructor(w){this.fetchTile=(g,m,T,K,U)=>this.actor.send("fetchTile",[],K,U,this.managerId,g,m,T),this.fetchAndParseTile=(g,m,T,K,U)=>this.actor.send("fetchAndParseTile",[],K,U,this.managerId,g,m,T),this.fetchContourTile=(g,m,T,K,U,re)=>this.actor.send("fetchContourTile",[],U,re,this.managerId,g,m,T,K);const F=this.managerId=++R;this.actor=w.actor||k(),this.loaded=this.actor.send("init",[],new AbortController,void 0,Object.assign(Object.assign({},w),{managerId:F}))}}Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Promise((w,F)=>{const g=new FileReader;g.onload=m=>{var T;return w((T=m.target)===null||T===void 0?void 0:T.result)},g.onerror=F,g.readAsArrayBuffer(this)})});const v=p=>(w,F)=>{if(F instanceof AbortController)return p(w,F);{const g=new AbortController;return p(w,g).then(m=>F(void 0,m.data,m.cacheControl,m.expires),m=>F(m)).catch(m=>F(m)),{cancel:()=>g.abort()}}},O=new Set;class Y{constructor({url:w,cacheSize:F=100,id:g="dem",encoding:m="terrarium",maxzoom:T=12,worker:K=!0,timeoutMs:U=1e4,actor:re}){this.timingCallbacks=[],this.onTiming=x=>{this.timingCallbacks.push(x)},this.setupMaplibre=x=>{x.addProtocol(this.sharedDemProtocolId,this.sharedDemProtocol),x.addProtocol(this.contourProtocolId,this.contourProtocol)},this.sharedDemProtocolV4=(x,_)=>u._(this,void 0,void 0,function*(){const[Z,X,E]=this.parseUrl(x.url),Q=new u.T("main");let j;try{const N=yield this.manager.fetchTile(Z,X,E,_,Q);return j=Q.finish(x.url),{data:yield N.data.arrayBuffer(),cacheControl:N.cacheControl,expires:N.expires}}catch(N){throw j=Q.error(x.url),N}finally{this.timingCallbacks.forEach(N=>N(j))}}),this.contourProtocolV4=(x,_)=>u._(this,void 0,void 0,function*(){const Z=new u.T("main");let X;try{const[E,Q,j]=this.parseUrl(x.url),N=u.a(x.url),ue=yield this.manager.fetchContourTile(E,Q,j,u.g(N,E),_,Z);return X=Z.finish(x.url),{data:ue.arrayBuffer}}catch(E){throw X=Z.error(x.url),E}finally{this.timingCallbacks.forEach(E=>E(X))}}),this.contourProtocol=v(this.contourProtocolV4),this.sharedDemProtocol=v(this.sharedDemProtocolV4),this.contourProtocolUrl=x=>`${this.contourProtocolUrlBase}?${u.e(x)}`;let z=g,ve=1;for(;O.has(z);)z=g+ve++;O.add(z),this.sharedDemProtocolId=`${z}-shared`,this.contourProtocolId=`${z}-contour`,this.sharedDemProtocolUrl=`${this.sharedDemProtocolId}://{z}/{x}/{y}`,this.contourProtocolUrlBase=`${this.contourProtocolId}://{z}/{x}/{y}`;const fe=K?B:u.L;this.manager=new fe({demUrlPattern:w,cacheSize:F,encoding:m,maxzoom:T,timeoutMs:U,actor:re})}getDemTile(w,F,g,m){return this.manager.fetchAndParseTile(w,F,g,m||new AbortController)}parseUrl(w){const[,F,g,m]=/\/\/(\d+)\/(\d+)\/(\d+)/.exec(w)||[];return[Number(F),Number(g),Number(m)]}}return{generateIsolines:u.b,DemSource:Y,HeightTile:u.H,LocalDemManager:u.L,decodeParsedImage:u.c,set workerUrl(p){I.workerUrl=p},get workerUrl(){return I.workerUrl}}});var St=Te;export{St as default};
//# sourceMappingURL=contour-iMovH0NX.js.map
